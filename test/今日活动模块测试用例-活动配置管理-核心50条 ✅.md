# 今日活动模块测试用例 - 活动配置管理（核心50条）

## 一、配置管理器打开和关闭（5条）

### TC-001: 打开配置管理器 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 打开抽卡模态框
2. 点击设置图标（⚙️）

**预期结果：**
- 打开活动配置管理器模态框
- 显示配置管理界面
- 左侧显示一级分类列表
- 右侧显示选中分类的二级活动项列表
- 显示统计信息（X个分类，共X个活动）
- 默认选中第一个分类

### TC-002: 关闭配置管理器 - 点击关闭按钮（配置正确） ✅
**优先级：** P0  
**测试步骤：**
1. 打开配置管理器
2. 确保配置符合保存条件（概率总和为100%）
3. 点击右上角关闭按钮（✕）

**预期结果：**
- 配置管理器直接关闭
- 返回抽卡模态框
- 配置已保存

### TC-003: 关闭配置管理器 - 点击关闭按钮（配置不正确） ✅
**优先级：** P0  
**测试步骤：**

1. 打开配置管理器
2. 修改配置使概率总和不为100%
3. 点击右上角关闭按钮（✕）

**预期结果：**
- 显示确认对话框，提示配置不符合保存条件及具体原因
- 提示"如果退出，配置将重置为默认值"
- 用户确认后：重置为默认配置并关闭
- 用户取消后：保持模态框打开，允许继续修改

### TC-004: 关闭配置管理器 - 点击外部遮罩 ✅
**优先级：** P1  
**测试步骤：**
1. 打开配置管理器
2. 点击外部遮罩区域

**预期结果：**
- 模态框不关闭（点击外部无法关闭）
- 必须通过关闭按钮或ESC键关闭

### TC-005: 关闭配置管理器 - ESC键退出 ✅
**优先级：** P1  
**测试步骤：**
1. 打开配置管理器
2. 按ESC键

**预期结果：**
- 如果配置正确：直接关闭
- 如果配置不正确：显示确认对话框（同TC-003）
- 事件不传播到抽卡模态框（不会同时关闭抽卡模态框）

## 二、一级分类管理功能（15条）

### TC-006: 添加一级分类 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 打开配置管理器
2. 点击左侧"➕"按钮（新增分类）

**预期结果：**

- 新增一个分类
- 默认名称为"分类"（如果已存在则为"分类1"、"分类2"等）
- 分类类型为CUSTOM（自定义）
- 默认概率为0%
- 默认选中新创建的分类（选中第一个分类）
- 显示成功提示："新增成功！"

### TC-007: 添加一级分类 - 数量限制 ✅
**优先级：** P1  
**测试步骤：**
1. 打开配置管理器
2. 连续添加分类直到达到20个
3. 再次点击添加按钮

**预期结果：**
- 显示错误提示："一级分类最多只能创建20个，无法继续添加"
- 无法继续添加

### TC-008: 编辑一级分类名称 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 打开配置管理器
2. 点击分类的编辑按钮（✏️）
3. 修改名称
4. 点击保存按钮（💾）

**预期结果：**
- 进入编辑模式
- 名称输入框显示当前名称
- 修改后保存成功
- 显示成功提示："保存成功！"
- 退出编辑模式

### TC-009: 编辑一级分类名称 - 名称为空 ✅
**优先级：** P0  
**测试步骤：**
1. 进入编辑模式
2. 删除所有名称内容
3. 点击保存

**预期结果：**
- 显示错误提示："分类名称不能为空"
- 不允许保存
- 保持编辑模式

### TC-010: 编辑一级分类名称 - 名称长度限制 ✅
**优先级：** P1  
**测试步骤：**

1. 进入编辑模式
2. 输入超过4个字符的名称
3. 点击保存

**预期结果：**
- 显示错误提示："分类名称不能超过4个字"
- 不允许保存
- 输入框有maxLength限制（4）

### TC-011: 编辑一级分类名称 - 名称重复校验 ✅
**优先级：** P1  
**测试步骤：**

1. 已有分类"测试"
2. 编辑另一个分类，改名为"测试"
3. 点击保存

**预期结果：**
- 显示错误提示："分类名称"测试"已存在，请使用其他名称"
- 不允许保存

### TC-012: 编辑一级分类概率 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 进入编辑模式
2. 修改概率值（如改为30）
3. 点击保存

**预期结果：**
- 概率更新成功
- 自定义分类的概率自动调整
- 显示成功提示："保存成功！"

### TC-013: 编辑一级分类概率 - 概率为0时显示 ✅
**优先级：** P1  
**测试步骤：**

1. 分类概率为0%
2. 点击编辑按钮

**预期结果：**
- 概率输入框显示0（而不是空白）
- 允许用户删除数字（变成空字符串）
- 保存时如果为空会提示错误

### TC-014: 编辑一级分类概率 - 概率为空时保存 ✅
**优先级：** P0  
**测试步骤：**
1. 进入编辑模式
2. 删除概率输入框中的所有内容
3. 点击保存

**预期结果：**
- 显示错误提示："请输入分类概率"
- 不允许保存
- 保持编辑模式

### TC-015: 编辑一级分类 - Ctrl+Enter快捷键保存 ✅
**优先级：** P2  
**测试步骤：**
1. 进入编辑模式
2. 修改名称或概率
3. 按Ctrl+Enter

**预期结果：**
- 保存成功
- 退出编辑模式

### TC-016: 编辑一级分类 - 取消编辑 ✅
**优先级：** P1  
**测试步骤：**
1. 进入编辑模式
2. 修改内容
3. 点击取消按钮（❌）

**预期结果：**
- 内容恢复为原始值
- 退出编辑模式
- 编辑状态被清除

### TC-017: 删除一级分类 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 打开配置管理器
2. 选择一个分类
3. 点击删除按钮（🗑️）
4. 确认删除

**预期结果：**
- 显示确认对话框
- 如果分类下有活动项，提示"该分类下的 X 个活动也将被删除"
- 确认后分类被删除
- 显示成功提示："删除成功！"
- 如果删除的是当前选中分类，自动选中第一个分类

### TC-018: 删除一级分类 - 取消删除 ✅
**优先级：** P1  
**测试步骤：**

1. 点击删除按钮
2. 在确认对话框中点击取消

**预期结果：**

- 分类未被删除
- 列表保持不变

### TC-019: 删除一级分类 - 删除自定义分类 ✅
**优先级：** P1  
**测试步骤：**

1. 尝试删除"自定义"分类

**预期结果：**

- "自定义"分类不显示删除按钮
- 无法删除

### TC-020: 选择一级分类 - 切换分类 ✅
**优先级：** P0  
**测试步骤：**
1. 打开配置管理器
2. 点击不同的分类

**预期结果：**
- 分类被选中（高亮显示）
- 右侧显示该分类下的活动项列表
- 标题更新为"二级分类 - [分类名称]"

## 三、二级活动项管理功能（15条）

### TC-021: 添加二级活动项 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 选择一个分类
2. 点击右侧"➕"按钮（新增活动）

**预期结果：**

- 新增一个活动项
- 默认名称为"新活动"（如果已存在则为"新活动1"、"新活动2"等）
- 默认概率为0%
- 显示成功提示："新增成功！"

### TC-022: 添加二级活动项 - 未选择分类 ✅
**优先级：** P1  
**测试步骤：**
1. 打开配置管理器
2. 未选择任何分类
3. 尝试点击添加活动按钮

**预期结果：**
- 显示错误提示："请先选择一个分类"
- 无法添加

### TC-023: 添加二级活动项 - 数量限制 ✅
**优先级：** P1  
**测试步骤：**
1. 选择一个分类
2. 连续添加活动项直到达到20个
3. 再次点击添加按钮

**预期结果：**
- 显示错误提示："每个一级分类下的二级分类最多只能创建20个"
- 无法继续添加

### TC-024: 编辑二级活动项名称 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 点击活动项的编辑按钮（✏️）
2. 修改名称
3. 点击保存按钮（💾）

**预期结果：**
- 进入编辑模式
- 名称输入框显示当前名称
- 修改后保存成功
- 显示成功提示："保存成功！"
- 退出编辑模式

### TC-025: 编辑二级活动项名称 - 名称为空 ✅
**优先级：** P0  
**测试步骤：**
1. 进入编辑模式
2. 删除所有名称内容
3. 点击保存

**预期结果：**
- 显示错误提示："活动名称不能为空"
- 不允许保存

### TC-026: 编辑二级活动项名称 - 名称长度限制 ✅
**优先级：** P1  
**测试步骤：**
1. 进入编辑模式
2. 输入超过5个字符的名称
3. 点击保存

**预期结果：**
- 显示错误提示："活动名称不能超过5个字"
- 不允许保存
- 输入框有maxLength限制（5）

### TC-027: 编辑二级活动项名称 - 同分类内名称重复 ✅
**优先级：** P1  
**测试步骤：**
1. 分类下已有"测试活动"
2. 编辑另一个活动项，改名为"测试活动"
3. 点击保存

**预期结果：**

- 显示错误提示："活动名称"测试活动"已存在于当前分类中，请使用其他名称"
- 不允许保存

### TC-028: 编辑二级活动项概率 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 进入编辑模式
2. 修改概率值（如改为25）
3. 点击保存

**预期结果：**
- 概率更新成功
- 显示成功提示："保存成功！"

### TC-029: 编辑二级活动项概率 - 概率为0时显示 ✅
**优先级：** P1  
**测试步骤：**

1. 活动项概率为0%
2. 点击编辑按钮

**预期结果：**

- 概率输入框显示0（而不是空白）
- 允许用户删除数字（变成空字符串）
- 保存时如果为空会提示错误

### TC-030: 编辑二级活动项概率 - 概率为空时保存 ✅
**优先级：** P0  
**测试步骤：**

1. 进入编辑模式
2. 删除概率输入框中的所有内容
3. 点击保存

**预期结果：**

- 显示错误提示："请输入活动概率"
- 不允许保存

### TC-031: 编辑二级活动项 - Ctrl+Enter快捷键保存 ✅
**优先级：** P2  
**测试步骤：**
1. 进入编辑模式
2. 修改名称或概率
3. 按Ctrl+Enter

**预期结果：**
- 保存成功
- 退出编辑模式

### TC-032: 编辑二级活动项 - 取消编辑 ✅
**优先级：** P1  
**测试步骤：**

1. 进入编辑模式
2. 修改内容
3. 点击取消按钮（❌）

**预期结果：**
- 内容恢复为原始值
- 退出编辑模式
- 编辑状态被清除

### TC-033: 删除二级活动项 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 选择一个活动项
2. 点击删除按钮（🗑️）
3. 确认删除

**预期结果：**
- 显示确认对话框："确定要删除"[活动名称]"活动吗？"
- 确认后活动项被删除
- 显示成功提示："删除成功！"
- 如果正在编辑该项目，退出编辑状态

### TC-034: 删除二级活动项 - 取消删除 ✅
**优先级：** P1  
**测试步骤：**
1. 点击删除按钮
2. 在确认对话框中点击取消

**预期结果：**
- 活动项未被删除
- 列表保持不变

### TC-035: 删除二级活动项 - 删除自定义分类下的活动项 ❌
**优先级：** P1  
**测试步骤：**
1. 选择"自定义"分类
2. 尝试删除活动项

**预期结果：**
- "自定义"分类下的活动项不显示删除按钮
- 无法删除

## 四、概率校验和自动平衡功能（8条）

### TC-036: 概率校验 - 一级分类总概率不为100% ✅
**优先级：** P0  
**测试步骤：**
1. 修改多个分类的概率
2. 使总概率不为100%（如总和为80%）
3. 点击关闭按钮

**预期结果：**
- 关闭时显示错误提示："一级分类总概率为 80.0%，必须为 100%"
- 提示如果退出将重置为默认值

### TC-037: 概率校验 - 活动项概率总和与分类概率不匹配 ✅
**优先级：** P0  
**测试步骤：**
1. 分类概率为30%
2. 分类下的活动项概率总和为40%
3. 点击关闭按钮

**预期结果：**
- 关闭时显示错误提示："[分类名称] 分类的活动项概率总和为 40.0%，应该等于该分类概率 30.0%"
- 提示如果退出将重置为默认值

### TC-038: 概率显示 - 概率不匹配警告 ✅
**优先级：** P1  
**测试步骤：**
1. 分类概率为30%
2. 活动项概率总和为40%
3. 观察显示

**预期结果：**
- 显示：30% (40%)
- 括号内的数字显示为红色（mismatch样式）
- 提示概率不匹配

### TC-039: 自动平衡所有概率 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 打开配置管理器
2. 修改一些概率值
3. 点击右上角"⚖️"按钮（自动平衡所有概率）

**预期结果：**
- 所有一级分类概率平均分配（总和为100%）
- 每个分类下的活动项概率也平均分配
- 显示成功提示："自动平衡成功！"

### TC-040: 自动平衡当前分类活动项概率 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**

1. 选择一个分类
2. 修改该分类下的活动项概率
3. 点击右侧"⚖️"按钮（自动平衡该分类下的活动概率）

**预期结果：**
- 该分类下的活动项概率平均分配
- 总和等于分类概率
- 显示成功提示："自动平衡成功！"

### TC-041: 自动平衡当前分类活动项概率 - 无活动项 ✅
**优先级：** P1  
**测试步骤：**
1. 选择一个没有活动项的分类
2. 点击"⚖️"按钮

**预期结果：**
- 显示提示："当前分类没有活动项，请先添加活动"
- 不执行平衡操作

### TC-042: 自定义分类概率自动计算 ✅
**优先级：** P1  
**测试步骤：**
1. 修改非自定义分类的概率
2. 观察"自定义"分类的概率

**预期结果：**

- "自定义"分类的概率自动计算为：100% - 其他分类概率总和
- 如果其他分类总和超过100%，自定义分类概率可能为负数（显示红色警告）

### TC-043: 页面刷新时配置校验 ✅
**优先级：** P0  
**测试步骤：**

1. 修改配置使概率不符合条件
2. 刷新页面

**预期结果：**
- 页面加载时自动检测配置
- 如果不符合条件，自动重置为默认配置
- 显示错误提示："配置不符合保存条件，已重置为默认配置"
- 重置后默认选中第一个分类

## 五、重置配置功能（4条）

### TC-044: 重置配置 - 基本功能 ✅
**优先级：** P0  
**测试步骤：**
1. 打开配置管理器
2. 修改一些配置
3. 点击右上角"🔄"按钮（重置为默认）
4. 确认重置

**预期结果：**
- 显示确认对话框："确定要重置为默认配置吗？\n\n所有自定义设置将丢失且无法恢复！"
- 确认后配置恢复为默认值
- 所有自定义修改被清除
- 显示成功提示："重置成功！"
- 退出编辑状态（如果有）
- 重置后默认选中第一个分类

### TC-045: 重置配置 - 取消重置 ✅
**优先级：** P1  
**测试步骤：**
1. 点击重置按钮
2. 在确认对话框中点击取消

**预期结果：**
- 配置保持不变
- 当前修改保留
- 不执行重置操作

### TC-046: 重置配置 - 编辑状态下重置 ✅
**优先级：** P1  
**测试步骤：**
1. 进入编辑模式
2. 点击重置按钮
3. 确认重置

**预期结果：**
- 配置重置成功
- 编辑状态被清除
- 错误信息被清除
- 重置后默认选中第一个分类

### TC-047: 重置配置 - 重置后数据持久化 ✅
**优先级：** P1  
**测试步骤：**
1. 重置配置
2. 关闭配置管理器
3. 重新打开配置管理器

**预期结果：**
- 配置仍为默认值
- 数据已保存到localStorage
- 刷新页面后仍为默认值

## 六、数据持久化和界面交互（3条）

### TC-048: 数据持久化 - 配置保存 ✅
**优先级：** P0  
**测试步骤：**
1. 修改配置（添加分类、修改概率等）
2. 关闭配置管理器
3. 重新打开配置管理器

**预期结果：**
- 修改的配置已保存
- 显示与关闭前一致

### TC-049: 界面布局 - 模态框固定高度 ✅
**优先级：** P1  
**测试步骤：**
1. 打开配置管理器
2. 观察模态框高度

**预期结果：**
- 模态框高度固定为640px（桌面端）
- 不会因为内容多少而变化
- 内容超出时显示滚动条

### TC-050: 界面交互 - 图标大小和间距统一 ✅
**优先级：** P2  
**测试步骤：**
1. 打开配置管理器
2. 观察顶部操作按钮（重置、自动平衡、关闭）

**预期结果：**
- 所有图标大小统一（32px × 32px）
- 图标间距统一（0.75rem）
- 样式和交互效果一致

---

## 测试用例统计

- **总计：** 50条
- **P0（核心功能）：** 20条
- **P1（重要功能）：** 25条
- **P2（次要功能）：** 5条

## 测试覆盖范围

✅ **配置管理器打开和关闭**（5条）
- 打开、关闭、外部点击、ESC键、配置校验

✅ **一级分类管理**（15条）
- 添加、编辑、删除、数量限制、名称校验、概率校验、快捷键

✅ **二级活动项管理**（15条）
- 添加、编辑、删除、数量限制、名称校验、概率校验、快捷键

✅ **概率校验和自动平衡**（8条）
- 概率校验、自动平衡、自定义分类计算、页面刷新校验

✅ **重置配置**（4条）
- 重置、取消、编辑状态下重置、数据持久化

✅ **数据持久化和界面交互**（3条）
- 数据保存、界面布局、图标样式

---

**编写日期：** 2024年  
**版本：** v1.0  
**状态：** ✅ 已完成

