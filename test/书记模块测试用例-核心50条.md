# 书记模块核心测试用例（50条）

## 一、摘抄管理功能（15条）

### 1. 基础功能测试

#### TC-RE-001: 创建新摘抄
**前置条件**：进入书记模块，摘抄列表为空  
**测试步骤**：
1. 在摘抄输入框中输入内容："这是一段摘抄文字"
2. 按 Ctrl+Enter 保存
**预期结果**：
- 摘抄成功添加到列表顶部
- 输入框清空
- 显示创建时间戳
- 列表计数增加

#### TC-RE-002: 创建空内容摘抄（应失败）
**前置条件**：进入书记模块  
**测试步骤**：
1. 在摘抄输入框中输入空格或空内容
2. 按 Ctrl+Enter 保存
**预期结果**：
- 提示"摘抄内容不能为空！"
- 摘抄未创建
- 输入框内容保留

#### TC-RE-003: 摘抄内容长度限制
**前置条件**：进入书记模块  
**测试步骤**：
1. 在摘抄输入框中输入超过100个字符的内容
2. 观察字符计数显示
**预期结果**：
- 字符计数显示正确（如：100/100）
- 无法输入超过100个字符
- 剩余字符数小于20时显示警告样式

#### TC-RE-004: 编辑摘抄
**前置条件**：已存在至少一条摘抄  
**测试步骤**：
1. 点击一条摘抄进入编辑模式
2. 修改内容为："修改后的摘抄内容"
3. 按 Ctrl+Enter 保存
**预期结果**：
- 摘抄内容更新成功
- 时间戳更新为当前时间
- 退出编辑模式
- 列表中的摘抄显示更新后的内容

#### TC-RE-005: 取消编辑摘抄
**前置条件**：已存在至少一条摘抄  
**测试步骤**：
1. 点击一条摘抄进入编辑模式
2. 修改内容
3. 按 ESC 键
**预期结果**：
- 如果有未保存修改，弹出确认对话框
- 确认后退出编辑模式
- 内容恢复为原始内容
- 输入框清空

#### TC-RE-006: 删除单条摘抄（三连击）
**前置条件**：已存在至少一条摘抄  
**测试步骤**：
1. 快速连续点击删除按钮三次（在0.5秒内）
2. 观察删除结果
**预期结果**：
- 第一次点击：无反应
- 第二次点击：无反应
- 第三次点击：摘抄被删除
- 列表更新，计数减少

#### TC-RE-007: 删除摘抄（未达到三连击）
**前置条件**：已存在至少一条摘抄  
**测试步骤**：
1. 点击删除按钮一次
2. 等待0.6秒
3. 再次点击删除按钮
**预期结果**：
- 第一次点击后0.5秒，计数重置
- 第二次点击被视为第一次点击
- 摘抄未被删除

#### TC-RE-008: 删除所有摘抄
**前置条件**：已存在多条摘抄  
**测试步骤**：
1. 点击"删除所有摘抄"按钮
2. 在确认对话框中点击"确定"
**预期结果**：
- 弹出确认对话框，显示摘抄数量
- 确认后所有摘抄被删除
- 列表显示空状态提示
- 计数归零

#### TC-RE-009: 取消删除所有摘抄
**前置条件**：已存在多条摘抄  
**测试步骤**：
1. 点击"删除所有摘抄"按钮
2. 在确认对话框中点击"取消"
**预期结果**：
- 摘抄未被删除
- 列表保持不变

### 2. 搜索功能测试

#### TC-RE-010: 搜索摘抄（匹配内容）
**前置条件**：已存在多条摘抄，其中一条包含"测试"  
**测试步骤**：
1. 在搜索框中输入"测试"
2. 观察列表变化
**预期结果**：
- 只显示包含"测试"的摘抄
- 其他摘抄被过滤
- 搜索框显示"搜索文本"提示

#### TC-RE-011: 搜索摘抄（无匹配结果）
**前置条件**：已存在多条摘抄  
**测试步骤**：
1. 在搜索框中输入"不存在的关键词"
2. 观察列表变化
**预期结果**：
- 列表为空
- 显示空状态提示

#### TC-RE-012: 清空搜索
**前置条件**：已执行搜索，有搜索结果  
**测试步骤**：
1. 清空搜索框内容
2. 观察列表变化
**预期结果**：
- 显示所有摘抄
- 列表恢复正常状态

### 3. 导入导出功能测试

#### TC-RE-013: 导出所有摘抄
**前置条件**：已存在多条摘抄  
**测试步骤**：
1. 点击"导出所有摘抄为JSON"按钮
2. 保存文件
3. 打开导出的JSON文件
**预期结果**：
- 文件成功下载
- JSON格式正确，包含version、exportDate、readingExcerpts字段
- readingExcerpts数组包含所有摘抄数据
- totalReadingExcerpts字段正确

#### TC-RE-014: 导入摘抄（新格式）
**前置条件**：已导出摘抄JSON文件  
**测试步骤**：
1. 点击"从JSON导入摘抄"按钮
2. 选择之前导出的JSON文件
**预期结果**：
- 导入成功
- 显示导入结果（新增X条，跳过X条）
- 重复的摘抄被跳过（基于ID）
- 列表更新

#### TC-RE-015: 导入摘抄（旧格式兼容）
**前置条件**：有旧格式的JSON文件（包含quickNotes字段）  
**测试步骤**：
1. 点击"从JSON导入摘抄"按钮
2. 选择旧格式JSON文件
**预期结果**：
- 导入成功
- 兼容旧格式的quickNotes字段
- 数据正确导入

## 二、书记管理功能（20条）

### 1. 创建和编辑功能

#### TC-RE-016: 创建新书记
**前置条件**：进入书记模块，选择今天日期  
**测试步骤**：
1. 在书记编辑器中输入内容："今天读了一本好书"
2. 选择主题、天气、心情
3. 点击保存按钮
**预期结果**：
- 书记创建成功
- 显示在书记列表顶部
- 日期显示为今天
- 序号显示为#1

#### TC-RE-017: 创建同一天多篇书记
**前置条件**：今天已有一篇书记  
**测试步骤**：
1. 选择今天日期
2. 创建新书记："第二篇书记"
3. 观察序号
**预期结果**：
- 新书记创建成功
- 序号显示为#2
- 两篇书记都显示在列表中
- 按创建时间排序

#### TC-RE-018: 编辑书记内容
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的一篇书记
2. 修改内容
3. 点击保存
**预期结果**：
- 内容更新成功
- updatedAt时间戳更新
- 列表中的书记显示更新后的内容
- createdAt时间戳保持不变

#### TC-RE-019: 修改书记日期
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的一篇书记
2. 修改日期为昨天
3. 点击保存
**预期结果**：
- 书记日期更新成功
- 书记移动到新日期位置
- 序号根据新日期重新计算

#### TC-RE-020: 修改书记主题
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的一篇书记
2. 点击主题选择器，选择新主题
3. 点击保存
**预期结果**：
- 主题更新成功
- 书记列表中的背景色更新
- 保存后主题保持不变

#### TC-RE-021: 修改书记天气和心情
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的一篇书记
2. 修改天气为"雨天"
3. 修改心情为"平静"
4. 点击保存
**预期结果**：
- 天气和心情更新成功
- 列表中的图标更新
- 导出时包含天气和心情信息

#### TC-RE-022: 修改书记字体
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的一篇书记
2. 点击字体选择器，选择新字体
3. 观察编辑器中的字体变化
4. 点击保存
**预期结果**：
- 字体更新成功
- 编辑器中的字体样式立即更新
- 保存后字体保持不变

#### TC-RE-023: 创建空内容书记（应失败）
**前置条件**：进入书记模块  
**测试步骤**：
1. 在编辑器中不输入任何内容
2. 点击保存按钮
**预期结果**：
- 提示"内容不能为空"
- 书记未创建
- 编辑器保持打开状态

### 2. 图片管理功能

#### TC-RE-024: 上传图片到书记
**前置条件**：正在编辑或创建书记  
**测试步骤**：
1. 点击图片上传按钮
2. 选择一张图片文件（小于5MB）
3. 观察图片显示
4. 点击保存
**预期结果**：
- 图片上传成功
- 图片显示在编辑器中
- 保存后图片存储在IndexedDB中
- entry中只保存imageId，不保存base64数据

#### TC-RE-025: 上传超大图片（应失败）
**前置条件**：正在编辑或创建书记  
**测试步骤**：
1. 点击图片上传按钮
2. 选择一张大于5MB的图片文件
**预期结果**：
- 提示"图片大小不能超过5MB"
- 图片未上传
- 编辑器状态不变

#### TC-RE-026: 上传非图片文件（应失败）
**前置条件**：正在编辑或创建书记  
**测试步骤**：
1. 点击图片上传按钮
2. 选择一个非图片文件（如.txt文件）
**预期结果**：
- 提示错误信息
- 文件未上传
- 编辑器状态不变

#### TC-RE-027: 删除书记中的图片
**前置条件**：已存在一篇带图片的书记  
**测试步骤**：
1. 点击书记进入编辑模式
2. 删除图片
3. 点击保存
**预期结果**：
- 图片从编辑器中移除
- 保存后IndexedDB中的图片被删除
- entry中的imageId字段被移除

#### TC-RE-028: 替换书记中的图片
**前置条件**：已存在一篇带图片的书记  
**测试步骤**：
1. 点击书记进入编辑模式
2. 上传新图片替换旧图片
3. 点击保存
**预期结果**：
- 新图片显示在编辑器中
- 旧图片从IndexedDB中删除
- 新图片保存到IndexedDB
- imageId更新为新图片的ID

#### TC-RE-029: 加载带图片的书记
**前置条件**：已存在一篇带图片的书记（图片存储在IndexedDB）  
**测试步骤**：
1. 刷新页面
2. 点击书记列表中的该书记
**预期结果**：
- 书记内容加载成功
- 图片从IndexedDB异步加载
- 图片正确显示在编辑器中

### 3. 删除功能

#### TC-RE-030: 删除单条书记
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的删除按钮
2. 在确认对话框中点击"确定"
**预期结果**：
- 书记被删除
- 如果书记有图片，IndexedDB中的图片也被删除
- 列表更新
- 计数减少

#### TC-RE-031: 取消删除书记
**前置条件**：已存在至少一篇书记  
**测试步骤**：
1. 点击书记列表中的删除按钮
2. 在确认对话框中点击"取消"
**预期结果**：
- 书记未被删除
- 列表保持不变

#### TC-RE-032: 删除所有书记
**前置条件**：已存在多条书记，部分带图片  
**测试步骤**：
1. 点击"删除所有书记"按钮
2. 在确认对话框中点击"确定"
**预期结果**：
- 弹出确认对话框
- 确认后所有书记被删除
- IndexedDB中所有相关图片被删除
- 列表显示空状态

### 4. 搜索和筛选功能

#### TC-RE-033: 搜索书记内容
**前置条件**：已存在多条书记  
**测试步骤**：
1. 在书记列表搜索框中输入关键词
2. 观察列表变化
**预期结果**：
- 只显示包含关键词的书记
- 搜索基于HTML内容的纯文本
- 其他书记被过滤

#### TC-RE-034: 搜索书记（无匹配结果）
**前置条件**：已存在多条书记  
**测试步骤**：
1. 在搜索框中输入不存在的关键词
2. 观察列表变化
**预期结果**：
- 列表为空
- 显示空状态提示

### 5. 序号计算功能

#### TC-RE-035: 同一天多篇书记序号计算
**前置条件**：同一天已有多篇书记  
**测试步骤**：
1. 观察列表中同一天书记的序号显示
2. 创建新书记在同一天
3. 观察序号变化
**预期结果**：
- 序号按创建时间排序（#1, #2, #3...）
- 新创建的书记序号正确
- 删除书记后序号重新计算

#### TC-RE-036: 不同日期书记序号独立计算
**前置条件**：存在不同日期的书记  
**测试步骤**：
1. 观察不同日期书记的序号
2. 每个日期都有#1序号
**预期结果**：
- 每个日期的序号从#1开始
- 不同日期的序号互不影响

## 三、导入导出功能（10条）

### 1. 书记导入导出

#### TC-RE-037: 导出所有书记
**前置条件**：已存在多条书记，部分带图片  
**测试步骤**：
1. 点击"导出所有书记为JSON"按钮
2. 保存文件
3. 打开导出的JSON文件
**预期结果**：
- 文件成功下载
- JSON格式正确，包含version、exportDate、readingEntries字段
- readingEntries数组包含所有书记数据
- 图片数据包含在entry.image字段中（base64格式）
- totalReadingEntries字段正确

#### TC-RE-038: 导入书记（新格式）
**前置条件**：已导出书记JSON文件  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择之前导出的JSON文件
**预期结果**：
- 导入成功
- 显示导入结果（新增X条，跳过X条）
- 重复的书记被跳过（基于ID）
- 图片数据迁移到IndexedDB
- 列表更新

#### TC-RE-039: 导入书记（旧格式兼容）
**前置条件**：有旧格式的JSON文件（包含diaryEntries字段）  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择旧格式JSON文件
**预期结果**：
- 导入成功
- 兼容旧格式的diaryEntries字段
- 数据正确导入

#### TC-RE-040: 导入书记（无效JSON格式）
**前置条件**：有一个无效的JSON文件  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择无效JSON文件
**预期结果**：
- 提示"文件格式错误：无法解析JSON"
- 导入失败
- 数据未改变

#### TC-RE-041: 导入书记（数据是数组）
**前置条件**：有一个JSON文件，内容是数组而不是对象  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
**预期结果**：
- 提示"无效的数据格式：数据必须是JSON对象，不能是数组"
- 导入失败
- 数据未改变

#### TC-RE-042: 导入书记（缺少readingEntries字段）
**前置条件**：有一个JSON文件，缺少readingEntries字段  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
**预期结果**：
- 提示"无效的数据格式：缺少readingEntries数组或diaryEntries数组"
- 导入失败
- 数据未改变

#### TC-RE-043: 导入书记（无效的日期格式）
**前置条件**：有一个JSON文件，包含无效日期格式的书记  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
**预期结果**：
- 提示具体的日期格式错误信息
- 导入失败
- 数据未改变

#### TC-RE-044: 导入书记（无效的base64图片）
**前置条件**：有一个JSON文件，包含无效base64图片数据的书记  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
3. 观察控制台警告
**预期结果**：
- 导入成功（宽松处理）
- 控制台显示警告信息
- 书记创建成功，但图片可能无法显示

#### TC-RE-045: 导入书记（图片格式不正确）
**前置条件**：有一个JSON文件，包含图片数据但格式不正确（不是data:image/开头）  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
3. 观察控制台警告
**预期结果**：
- 导入成功
- 控制台显示警告："书记 X 的图片格式可能不正确"
- 图片数据保存，但可能无法正常显示

### 2. 数据验证

#### TC-RE-046: 导入书记（缺少必需字段）
**前置条件**：有一个JSON文件，书记缺少id或date字段  
**测试步骤**：
1. 点击"从JSON导入书记"按钮
2. 选择该JSON文件
**预期结果**：
- 提示具体的字段缺失错误信息
- 导入失败
- 数据未改变

## 四、界面交互功能（5条）

#### TC-RE-047: 滚动到当前编辑的书记
**前置条件**：书记列表较长，当前编辑的书记不在可视区域  
**测试步骤**：
1. 点击列表中的一篇书记进入编辑模式
2. 观察列表滚动
**预期结果**：
- 列表自动滚动到当前编辑的书记位置
- 滚动动画平滑
- 书记项在可视区域内

#### TC-RE-048: 滚动到当前编辑的摘抄
**前置条件**：摘抄列表较长，当前编辑的摘抄不在可视区域  
**测试步骤**：
1. 点击列表中的一条摘抄进入编辑模式
2. 观察列表滚动
**预期结果**：
- 列表自动滚动到当前编辑的摘抄位置
- 滚动动画平滑
- 摘抄项在可视区域内

#### TC-RE-049: 未保存更改提示
**前置条件**：正在编辑书记，有未保存的更改  
**测试步骤**：
1. 修改书记内容
2. 尝试切换到其他书记或执行其他操作
**预期结果**：
- 提示有未保存的更改
- 询问是否继续
- 确认后才执行操作

#### TC-RE-050: 日期选择器功能
**前置条件**：进入书记模块  
**测试步骤**：
1. 点击日期选择器
2. 选择不同日期
3. 观察编辑器日期变化
**预期结果**：
- 日期选择器正常打开
- 选择的日期正确显示
- 编辑器中的日期更新
- 如果该日期已有书记，自动加载第一篇

---

## 测试覆盖说明

### 功能覆盖
- ✅ 摘抄的增删改查
- ✅ 书记的增删改查
- ✅ 图片上传和管理
- ✅ 搜索和筛选
- ✅ 导入导出（新格式和旧格式兼容）
- ✅ 数据验证
- ✅ 序号计算
- ✅ 界面交互

### 边界情况覆盖
- ✅ 空内容处理
- ✅ 长度限制
- ✅ 文件大小限制
- ✅ 格式验证
- ✅ 错误处理
- ✅ 数据兼容性

### 特殊场景覆盖
- ✅ 同一天多篇书记
- ✅ 图片存储和加载
- ✅ 三连击删除
- ✅ 未保存更改保护
- ✅ 滚动定位

